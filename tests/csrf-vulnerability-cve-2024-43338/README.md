# CSRF Vulnerability Tests (CVE-2024-43338)

This directory contains comprehensive testing tools for the CSRF vulnerability fix in the Crowdsignal plugin.

## Files

### `test-csrf-fix.php`
**Unit tests for the CSRF vulnerability fix**
- Tests admin context validation
- Tests capability checking (`edit_posts`)
- Verifies legitimate admin users can access functionality
- Confirms unauthorized users are blocked

**Usage:**
```bash
php tests/csrf-vulnerability-cve-2024-43338/test-csrf-fix.php
```

### `csrf-behavior-test.php`
**Real vulnerability behavior analysis**
- Shows actual difference between vulnerable/fixed versions
- Demonstrates filter injection attack vector
- Proves application-level security beyond HTTP status codes
- Works with both master (vulnerable) and fix branches

**Usage:**
```bash
# Test vulnerable version
git checkout master
php tests/csrf-vulnerability-cve-2024-43338/csrf-behavior-test.php

# Test fixed version
git checkout fix/csrf-vulnerability-cve-2024-43338
php tests/csrf-vulnerability-cve-2024-43338/csrf-behavior-test.php
```

### `csrf-attack-demo.html`
**Interactive browser-based CSRF demonstration**
- Visual attack simulation with educational content
- Real-world attack scenario testing
- Explains HTTP vs application-level security
- Includes testing methodology and results

**Usage:**
```bash
# Open in browser
open tests/csrf-vulnerability-cve-2024-43338/csrf-attack-demo.html

# Or visit directly
file:///path/to/crowdsignal-plugin/tests/csrf-vulnerability-cve-2024-43338/csrf-attack-demo.html
```

## Testing Workflow

### 1. Quick Validation
```bash
# Test current fix
php tests/csrf-vulnerability-cve-2024-43338/test-csrf-fix.php
```

### 2. Vulnerability Comparison
```bash
# Test vulnerable version
git checkout master
php tests/csrf-vulnerability-cve-2024-43338/csrf-behavior-test.php

# Test fixed version
git checkout fix/csrf-vulnerability-cve-2024-43338
php tests/csrf-vulnerability-cve-2024-43338/csrf-behavior-test.php
```

### 3. Interactive Demo
```bash
# Login to WordPress first
open http://localhost:8888/wp-admin/

# Then open demo
open tests/csrf-vulnerability-cve-2024-43338/csrf-attack-demo.html
```

## Expected Results

### Vulnerable Version (master branch)
```
‚ö†Ô∏è TESTING VULNERABLE VERSION
üö® ATTACK SUCCEEDED - 3 filters added:
   - type_url_form_video
   - type_url_form_audio
   - type_url_form_image
```

### Fixed Version (fix branch)
```
üõ°Ô∏è TESTING FIXED VERSION
‚úÖ ATTACK BLOCKED - No filters were added
üõ°Ô∏è Security check prevented CSRF exploitation
```

## Security Impact

**Before Fix:**
- External sites could manipulate plugin behavior via CSRF
- No permission checking for `polls_media` parameter
- Malicious filter injection possible

**After Fix:**
- Only admin users with `edit_posts` capability can access functionality
- External CSRF requests are blocked
- Legitimate admin functionality is preserved

## Educational Value

These tests demonstrate:
- How CSRF vulnerabilities work in practice
- Why HTTP status codes don't show the full security picture
- Proper security testing methodology for WordPress plugins
- Real-world attack scenarios and prevention techniques